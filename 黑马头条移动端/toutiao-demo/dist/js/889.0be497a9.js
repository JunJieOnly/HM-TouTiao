"use strict";(self["webpackChunktoutiao_demo"]=self["webpackChunktoutiao_demo"]||[]).push([[889],{3889:function(t,e,a){a.r(e),a.d(e,{default:function(){return N}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[e("van-button",{staticClass:"search-btn",attrs:{slot:"title",type:"info",size:"small",round:"",icon:"search",to:"/search"},slot:"title"},[t._v("搜索")])],1),e("van-tabs",{staticClass:"channel-tabs",attrs:{swipeable:"",animated:"",border:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channel,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("articleList",{attrs:{channel:t}})],1)})),e("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),e("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isEditShow=!0}},slot:"nav-right"},[e("i",{staticClass:"toutiao toutiao-gengduo"})])],2),e("van-popup",{style:{height:"100%"},attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.isEditShow,callback:function(e){t.isEditShow=e},expression:"isEditShow"}},[e("channel-edit",{attrs:{"my-channel":t.channel,"active-index":t.active},on:{changeTab:t.changeTab,changeIndex:t.changeIndex}})],1)],1)},n=[],s=a(4471);const l=()=>(0,s.Z)({url:"/v1_0/user/channels"}),r=t=>(0,s.Z)({url:"/v1_0/articles",params:t}),c=()=>(0,s.Z)({url:"/v1_0/channels"}),o=t=>(0,s.Z)({url:"/v1_0/user/channels",method:"PATCH",data:t}),h=t=>(0,s.Z)({url:"/v1_0/user/channels/"+t,method:"DELETE"});var d=function(){var t=this,e=t._self._c;return e("div",[e("van-pull-refresh",{attrs:{"success-text":t.successText},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,a){return e("articleItem",{key:a,attrs:{"article-item":t}})})),1)],1)],1)},u=[],m=function(){var t=this,e=t._self._c;return e("div",[e("van-cell",{staticClass:"article-item",attrs:{to:`/article/${t.articleItem.art_id}`},scopedSlots:t._u([{key:"title",fn:function(){return[e("h3",{staticClass:"title van-multi-ellipsis--l2"},[t._v(t._s(t.articleItem.title))])]},proxy:!0},1===t.articleItem.cover.type?{key:"default",fn:function(){return[e("van-image",{staticClass:"right-cover",attrs:{src:t.articleItem.cover.images[0],fit:"cover"}})]},proxy:!0}:null,{key:"label",fn:function(){return[3===t.articleItem.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.articleItem.cover.images,(function(t,a){return e("van-image",{key:a,staticClass:"cover-item-img",attrs:{src:t,fit:"cover"}})})),1):t._e(),e("div",{staticClass:"label-info-wrap"},[e("span",[t._v(t._s(t.articleItem.aut_name))]),e("span",[t._v(t._s(t.articleItem.comm_count))]),e("span",[t._v(t._s(t._f("relativeTime")(t.articleItem.pubdate)))])])]},proxy:!0}],null,!0)})],1)},v=[],p={name:"articltItem",props:{articleItem:{type:Object,require:!0}}},f=p,g=a(1001),_=(0,g.Z)(f,m,v,!1,null,null,null),C=_.exports,y={components:{articleItem:C},name:"articleList",props:{channel:{type:Object,required:!0}},data(){return{list:[],loading:!1,finished:!1,timestamp:Date.now(),error:!1,isLoading:!1,successText:""}},methods:{async onLoad(){try{const{data:t}=await r({channel_id:this.channel.id,timestamp:this.timestamp});this.list.push(...t.data.results),this.loading=!1,t.data.results.length<10?this.finished=!0:this.timestamp=t.data.pre_timestamp}catch(t){this.loading=!1,this.error=!0,console.log(t)}},async onRefresh(){try{const{data:t}=await r({channel_id:this.channel.id,timestamp:Date.now()});this.list.unshift(...t.data.results),this.successText=`成功加载了${t.data.results.length}条数据`}catch(t){console.log(t),this.$toast.fail("更新失败")}this.isLoading=!1}}},x=y,b=(0,g.Z)(x,d,u,!1,null,null,null),k=b.exports,I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-edit"},[e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),e("van-button",{staticClass:"edit-btn",attrs:{type:"danger",plain:"",round:"",size:"mini"},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(" "+t._s(t.isEdit?"完成":"编辑")+" ")])],1),e("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannel,(function(a,i){return e("van-grid-item",{key:a.id,staticClass:"grid-item",on:{click:function(e){return t.clickHandler(a,i)}}},[t.isEdit&&i!==t.activeIndex?e("van-icon",{attrs:{slot:"icon",name:"clear"},slot:"icon"}):t._e(),e("span",{staticClass:"text",class:{active:i===t.activeIndex},attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name))])],1)})),1),e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("频道推荐")])]),e("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.recommentChannels,(function(a){return e("van-grid-item",{key:a.id,staticClass:"grid-item",attrs:{icon:"plus",text:a.name},on:{click:function(e){return t.addChannel(a)}}})})),1)],1)},E=[],w=a(3822),S=a(7247),L={name:"ChannelEdit",props:{myChannel:{type:Array,require:!0},activeIndex:{type:Number,require:!0}},data(){return{allChannels:[],isEdit:!1}},computed:{...(0,w.Se)(["token"]),recommentChannels(){const t=[];return this.allChannels.forEach((e=>{let a=this.myChannel.find((t=>t.id===e.id));a||t.push(e)})),t}},created(){this.infoDate()},methods:{async infoDate(){try{const{data:t}=await c();this.allChannels=t.data.channels}catch(t){console.log(t)}},async addChannel(t){if(this.myChannel.push(t),this.token)try{await o({channels:[{id:t.id,seq:this.myChannel.length-1}]})}catch(e){this.$toast.fail("同步线上失败")}else(0,S.LS)("TOUTIAO-USER-CHANNELS",this.myChannel)},clickHandler(t,e){if(this.isEdit){if("推荐"===t.name)return;e<=this.activeIndex&&this.$emit("changeIndex",this.activeIndex-1),this.myChannel.splice(e,1),this.delSaveHandler(t.id)}else this.$emit("changeTab",e)},async delSaveHandler(t){this.token?await h(t):(0,S.LS)("TOUTIAO-USER-CHANNELS",this.myChannel)}}},T=L,H=(0,g.Z)(T,I,E,!1,null,"170647ca",null),Z=H.exports,A={name:"Home",components:{},props:{},data(){return{active:0,channel:null,isEditShow:!1}},computed:{},created(){this.initData()},methods:{async initData(){if(this.$store.getters.token)try{const{data:t}=await l();this.channel=t.data.channels}catch(t){console.log(t)}else{const e=(0,S.rV)("TOUTIAO-USER-CHANNELS");if(e)this.channel=e;else try{const{data:t}=await l();this.channel=t.data.channels}catch(t){console.log(t)}}},changeTab(t){this.active=t,this.isEditShow=!1},changeIndex(t){this.active=t}},components:{articleList:k,channelEdit:Z}},O=A,D=(0,g.Z)(O,i,n,!1,null,"52f3efae",null),N=D.exports}}]);