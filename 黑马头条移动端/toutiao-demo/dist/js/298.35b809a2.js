"use strict";(self["webpackChunktoutiao_demo"]=self["webpackChunktoutiao_demo"]||[]).push([[298],{7298:function(t,e,s){s.r(e),s.d(e,{default:function(){return h}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-contanier"},[e("van-nav-bar",{attrs:{title:"登录","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),e("van-form",{ref:"form",on:{submit:t.onSubmit}},[e("van-field",{attrs:{type:"Number",name:"mobile",maxlength:"11","icon-prefix":"toutiao","left-icon":"shouji",placeholder:"请输入手机号",rules:t.rules.mobile},model:{value:t.user.mobile,callback:function(e){t.$set(t.user,"mobile",e)},expression:"user.mobile"}}),e("van-field",{attrs:{type:"Number",name:"code","icon-prefix":"toutiao","left-icon":"yanzhengma",placeholder:"请输入验证码",rules:t.rules.code},scopedSlots:t._u([{key:"button",fn:function(){return[t.isCountDownShow?e("van-button",{attrs:{size:"small",type:"primary","native-type":"button"}},[e("van-count-down",{attrs:{time:5e3,format:"ss 秒"},on:{change:t.changeFn}})],1):e("van-button",{attrs:{size:"small",type:"primary","native-type":"button"},on:{click:t.sendSms}},[t._v("发送验证码")])]},proxy:!0}]),model:{value:t.user.code,callback:function(e){t.$set(t.user,"code",e)},expression:"user.code"}}),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{block:"",type:"info","native-type":"submit"}},[t._v("登录")])],1)],1)],1)},a=[],n=s(4471);const r=t=>(0,n.Z)({url:`/v1_0/sms/codes/${t}`}),i=t=>(0,n.Z)({method:"POST",url:"/v1_0/authorizations",data:t});var u=s(3822),c={name:"Login",data(){return{isCountDownShow:!1,user:{mobile:"",code:""},rules:{mobile:[{required:!0,message:"请输入手机号"},{pattern:/^1[3|4|5|6|7|8|9]\d{9}$/,message:"手机号格式不正确"}],code:[{required:!0,message:"请输入验证码"},{pattern:/\d{6}$/,message:"验证码格式不正确"}]}}},methods:{...(0,u.OI)(["setUser"]),async onSubmit(){this.$toast.loading({message:"登录中...",forbidClick:!0,duration:0});try{const{data:t}=await i(this.user);this.$store.commit("setUser",t.data)}catch(e){const{response:t}=e;return this.$toast.fail(t.data.message)}this.$toast.clear();const t=this.$route.query.url;t?this.$router.replace(t):this.$router.push("/my")},async sendSms(){try{await this.$refs.form.validate("mobile")}catch(t){return}this.isCountDownShow=!0;try{await r(this.user.mobile),this.$toast.success("发送验证码成功")}catch(t){const{response:e}=t;this.$toast.fail(e.data.message)}},changeFn(t){const{seconds:e}=t;0===e&&(this.isCountDownShow=!1)}}},l=c,m=s(1001),d=(0,m.Z)(l,o,a,!1,null,"3d398a89",null),h=d.exports}}]);