"use strict";(self["webpackChunktoutiao_demo"]=self["webpackChunktoutiao_demo"]||[]).push([[224],{5224:function(t,e,s){s.r(e),s.d(e,{default:function(){return Z}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-container"},[e("form",{attrs:{action:"/"}},[e("van-search",{attrs:{shape:"round","show-action":"",placeholder:"请输入搜索关键词",background:"#5094f3"},on:{focus:function(e){t.isResultsShow=!1},search:t.onSearch,cancel:t.onCancel},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),t.isResultsShow?e("search-result",{attrs:{"search-text":t.searchText}}):t.searchText?e("search-suggestion",{attrs:{"search-text":t.searchText},on:{search:t.onSearch}}):e("search-history",{attrs:{"search-histories":t.searchHistories},on:{searchHistory:t.onSearch}})],1)},i=[],r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-result"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t){return e("van-cell",{key:t.art_id,attrs:{title:t.title}})})),1)],1)},n=[],c=s(4471);const o=t=>(0,c.Z)({url:"/v1_0/suggestion",params:t}),h=t=>(0,c.Z)({url:"/v1_0/search",params:t});var l={name:"SearchResult",props:{searchText:{type:String,require:!0}},data(){return{list:[],loading:!1,finished:!1,page:1,per_page:10}},methods:{async onLoad(){try{const{data:t}=await h({page:this.page,per_page:this.per_page,q:this.searchText});this.list.push(...t.data.results),this.loading=!1,t.data.results.length<this.per_page?this.finished=!0:this.page++}catch(t){this.loading=!1,console.log(t)}}}},u=l,d=s(1001),p=(0,d.Z)(u,r,n,!1,null,"9dc26758",null),f=p.exports,g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-history"},[e("van-cell",{attrs:{title:"搜索历史"}},[t.isEdit?e("span",[e("span",{on:{click:function(e){return t.searchHistories.splice(0)}}},[t._v("全部删除")]),t._v("   "),e("span",{on:{click:function(e){t.isEdit=!1}}},[t._v("完成")])]):e("van-icon",{attrs:{name:"delete"},on:{click:function(e){t.isEdit=!0}}})],1),t._l(t.searchHistories,(function(s,a){return e("van-cell",{key:a,attrs:{title:s},on:{click:function(e){return t.clickHandler(s,a)}}},[t.isEdit?e("van-icon",{attrs:{name:"close"}}):t._e()],1)}))],2)},m=[],x={name:"SearchHistory",props:{searchHistories:{type:Array,require:!0}},data(){return{isEdit:!1}},methods:{clickHandler(t,e){this.isEdit?this.searchHistories.splice(e,1):this.$emit("searchHistory",t)}}},T=x,_=(0,d.Z)(T,g,m,!1,null,"0613a773",null),v=_.exports,S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-suggestion"},t._l(t.list,(function(s,a){return e("van-cell",{key:a,attrs:{icon:"search"},on:{click:function(e){return t.$emit("search",s)}},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{domProps:{innerHTML:t._s(t.hightColorText(s))}})]},proxy:!0}],null,!0)})})),1)},y=[],H={name:"SearchSuggestion",props:{searchText:{type:String,require:!0}},data(){return{list:[],timer:null}},watch:{searchText:{deep:!0,immediate:!0,handler(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.infoData()}),200)}}},created(){},methods:{async infoData(){try{const{data:t}=await o({q:this.searchText});1===t.data.options.length&&null===t.data.options[0]?this.list=[]:this.list=t.data.options}catch(t){console.log(t)}},hightColorText(t){let e=new RegExp(this.searchText,"gi");return t.replace(e,`<span style="color:red;">${this.searchText}</span>`)}}},k=H,w=(0,d.Z)(k,S,y,!1,null,"7fcda676",null),C=w.exports,R=s(7247),b={name:"Search",components:{SearchResult:f,SearchHistory:v,SearchSuggestion:C},data(){return{searchText:"",isResultsShow:!1,searchHistories:(0,R.rV)("TOUTIAO-HISTORY")||[]}},methods:{onSearch(t){this.searchText=t,this.isResultsShow=!0;let e=this.searchHistories.findIndex((e=>e===t));-1!==e&&this.searchHistories.splice(e,1),this.searchHistories.unshift(t)},onCancel(){this.$router.back()}},watch:{searchHistories(){(0,R.LS)("TOUTIAO-HISTORY",this.searchHistories)}}},E=b,O=(0,d.Z)(E,a,i,!1,null,"b8c0c58e",null),Z=O.exports}}]);